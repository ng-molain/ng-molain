<form nz-form [nzLayout]="nzLayout" (ngSubmit)="submitForm($event)">
  <ng-container *ngFor="let item of formItems">
    <ng-container *ngIf="item.type === 'fieldset'; else exactItemTpl"
                  [ngTemplateOutlet]="fieldsetTpl"
                  [ngTemplateOutletContext]="{$implicit: item}"></ng-container>
    <ng-template #exactItemTpl>
      <ng-container *ngTemplateOutlet="formItemTpl; context: {$implicit: item}"></ng-container>
    </ng-template>
  </ng-container>
  <nz-form-item>
    <nz-form-control nzOffset="6">
      <ng-content></ng-content>
    </nz-form-control>
  </nz-form-item>
</form>

<ng-template #formItemTpl let-item>
  <ml-form-item [formItem]="item"></ml-form-item>
</ng-template>

<ng-template #itemGroupTpl let-items>
  <ng-container *ngFor="let item of items">
    <ng-container *ngTemplateOutlet="formItemTpl; context: {$implicit: item}"></ng-container>
  </ng-container>
</ng-template>

<ng-template #fieldsetTpl let-fieldSet>
  <fieldset>
    <legend *ngIf="fieldSet.legend">{{fieldSet.legend}}</legend>
    <ng-container *ngTemplateOutlet="itemGroupTpl; context: {$implicit: fieldSet.items}"></ng-container>
  </fieldset>
</ng-template>

